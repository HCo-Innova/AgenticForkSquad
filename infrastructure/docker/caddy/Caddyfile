{
	auto_https off
	admin off
}

:80 {
	# Security headers globales
	header {
		X-Frame-Options "DENY"
		X-Content-Type-Options "nosniff"
		X-XSS-Protection "1; mode=block"
		Referrer-Policy "strict-origin-when-cross-origin"
		Permissions-Policy "geolocation=(), microphone=(), camera=()"
		-Server # Oculta versión de Caddy
	}

	# Proxy /health al backend para respuesta JSON del handler
	handle /health {
		reverse_proxy backend:8000
	}

	handle /api/* {
		reverse_proxy backend:8000
	}

	# Importante: manejar ruta exacta /ws y también prefijo /ws/*
	handle /ws {
		reverse_proxy backend:8000
	}
	handle /ws/* {
		reverse_proxy backend:8000
	}

	handle {
		reverse_proxy frontend:3000
	}
}
