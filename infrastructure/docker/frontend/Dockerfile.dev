# ============================================
# Frontend Development (React + Vite)
# ============================================
FROM node:22-alpine

LABEL maintainer="tu-email@ejemplo.com"

# Install dependencies
RUN apk add --no-cache curl && \
    rm -rf /var/cache/apk/*

# Node alpine ya tiene usuario 'node' con UID/GID 1000
# Usamos ese en lugar de crear uno nuevo
USER node

# Set workdir
WORKDIR /app

# Copy package files
COPY --chown=node:node frontend/package*.json ./

# Install dependencies
RUN npm install && npm cache clean --force

# Copy source code
COPY --chown=node:node frontend/ .

# Expose port
EXPOSE 3000

# Healthcheck
HEALTHCHECK --interval=30s --timeout=5s --start-period=10s --retries=3 \
    CMD curl -f http://localhost:3000/ || exit 1

# Start Vite
CMD ["npm", "run", "dev", "--", "--host", "0.0.0.0", "--port", "3000"]